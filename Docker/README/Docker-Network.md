
# 네트워크 및 요청

애플리케이션을 개발할 때, 여러 컨테이너가 필요한 경우가 많습니다. 주된 이유는 다음과 같습니다:
1. 각 컨테이너를 하나의 주요 작업에 집중하는 것이 좋습니다 (예: 웹 서버 실행, 데이터베이스 실행 등).
2. 하나의 컨테이너에 여러 "주요 작업"을 설정하는 것은 매우 어렵습니다 (예: 웹 서버와 데이터베이스 모두 실행).

## 멀티 컨테이너 애플리케이션

"실제 애플리케이션"에서 멀티 컨테이너 앱은 매우 일반적입니다. 이 때, 일부 컨테이너들은 서로 통신해야 할 수도 있습니다:
- 서로 간에 통신
- 호스트 머신과 통신
- 월드 와이드 웹(WWW)과 통신

### 월드 와이드 웹과의 통신

WWW와 통신(예: HTTP 요청이나 다른 종류의 요청을 외부 서버에 보내기)은 매우 간단합니다. 
다음은 JavaScript 예시입니다:

```javascript
fetch('https://some-api.com/my-data').then(...)
```

이 매우 기본적인 코드 스니펫은 'some-api.com/my-data'에 GET 요청을 보내려고 시도합니다. 이는 별도의 설정 없이도 바로 작동합니다. 컨테이너에서 실행 중인 애플리케이션은 이 요청을 보내는 데 문제가 없습니다.

### 호스트 머신과의 통신

호스트 머신과의 통신(예: 호스트 머신에서 실행 중인 데이터베이스와 통신)은 간단하지만, 약간의 설정이 필요합니다.

주의할 점: 컨테이너를 서버(즉, 다른 머신)에 배포하는 경우, 해당 머신과 통신해야 할 필요는 거의 없습니다. 호스트 머신과의 통신은 주로 개발 중에 필요한 경우가 많습니다 - 예를 들어, 로컬 개발 환경에서 데이터베이스를 실행 중인 경우입니다.

다시 JavaScript 예시를 보겠습니다:

```javascript
fetch('https://some-api.com/my-data').then(...)
fetch('localhost:3000/demo').then(...)
```

이 코드 스니펫은 로컬 호스트 머신(즉, 컨테이너 외부에 있지만 WWW는 아님)에서 실행 중인 웹 서버로 GET 요청을 보내려고 시도합니다.

로컬 머신에서는 이 코드가 작동하지만, 컨테이너 내부에서는 실패합니다. 왜냐하면 컨테이너 내부에서 `localhost`는 컨테이너 자체를 가리키지, 컨테이너를 실행하는 로컬 호스트 머신을 가리키지 않기 때문입니다.

그러나 Docker에서는 이를 쉽게 해결할 수 있습니다! 다음과 같이 코드 스니펫을 변경하기만 하면 됩니다:

```javascript
fetch('host.docker.internal:3000/demo').then(...)
```

`host.docker.internal`은 Docker에서 컨테이너를 호스팅하는 머신의 IP 주소로 번역되는 특별한 주소/식별자입니다. 

중요: "번역"된다고 해서 Docker가 소스 코드를 변경한다는 의미는 아닙니다. 대신, Docker는 나가는 요청을 감지하고 해당 요청에 대한 IP 주소를 해결할 수 있습니다.

### 다른 컨테이너와의 통신

다른 컨테이너와의 통신도 매우 간단합니다. 두 가지 주요 옵션이 있습니다:
1. 수동으로 다른 컨테이너의 IP를 찾아 설정 (IP가 변경될 수 있음).
2. Docker 네트워크를 사용하여 통신하는 컨테이너들을 동일한 네트워크에 배치.

옵션 1은 권장되지 않습니다. IP를 직접 검색해야 하고, 시간이 지나면서 IP가 변경될 수 있기 때문입니다.

옵션 2는 완벽한 해결책입니다. Docker에서 `docker network create 네트워크_이름` 명령어로 네트워크를 생성하고 여러 컨테이너를 같은 네트워크에 연결할 수 있습니다.

다음과 같이 설정할 수 있습니다:

```bash
docker network create my-network
docker run --network my-network --name cont1 my-image
docker run --network my-network --name cont2 my-other-image
```

이제 `cont1`과 `cont2`는 동일한 네트워크에 속해 있으며, 컨테이너 이름을 사용하여 서로 통신할 수 있습니다. Docker는 IP를 자동으로 해결해줍니다.

```javascript
fetch('cont1/my-data').then(...)
```

이렇게 하면 다른 컨테이너와도 간단하게 통신할 수 있습니다!